var ee=Object.defineProperty;var U=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var B=(f,n,r)=>n in f?ee(f,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):f[n]=r,V=(f,n)=>{for(var r in n||(n={}))te.call(n,r)&&B(f,r,n[r]);if(U)for(var r of U(n))ae.call(n,r)&&B(f,r,n[r]);return f};var p=(f,n,r)=>new Promise((k,b)=>{var D=h=>{try{x(r.next(h))}catch(_){b(_)}},t=h=>{try{x(r.throw(h))}catch(_){b(_)}},x=h=>h.done?k(h.value):Promise.resolve(h.value).then(D,t);x((r=r.apply(f,n)).next())});import{r as v,s as oe,l as T,o as se,c,a as i,u as C,i as z,t as y,D as le,F as L,h as N,m as g,f as O,B as re,j as d,v as F,ad as ne,n as j,x as ie,ae as ue,a2 as ce}from"./index-BHS4H-t9.js";import{_ as de}from"./Rectangle-Cxb5RPqE.js";import{l as m}from"./index-lALIhGVB.js";/* empty css              */const me={class:"max-w-[1920px] mx-auto px-10 pt-[82px] pb-4 bg-gray-50"},_e={class:"h-[261px] rounded-b-md bg-white"},pe={class:"relative"},fe={class:"absolute left-8 -bottom-8"},ve={class:"w-32 h-32 rounded-full border-4 border-white overflow-hidden"},ye=["src"],he={key:1,class:"w-full h-full bg-gray-200 flex items-center justify-center text-[40px] text-gray-600"},be={class:"pt-10 px-4"},ge={class:"text-3xl font-medium"},xe={class:"text-bodyh1 text-gray-600 mt-1"},we={class:"bg-white rounded-lg shadow mt-4"},Pe={class:"p-6"},Ce={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ke={class:"block text-bodyh1 font-normal text-gray-700 mb-1"},De={key:0,class:"text-red-500 pt-2"},Fe=["onUpdate:modelValue","type","name","placeholder","readonly","maxlength","onChange"],Ie=["max"],qe={key:2,class:"flex flex-col"},Se=["name"],Ee=["name"],Ue={class:"flex items-center"},Be=["onClick"],Ve={key:0,class:"ml-2 text-sm text-gray-600 truncate max-w-xs"},Te=["onUpdate:modelValue","name","disabled"],ze={value:"",disabled:""},Le=["value"],Ne={key:4,class:"text-red-500 text-[11px] mt-1"},Oe={class:"mt-6"},je=["disabled"],Ae={key:0,class:"inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"},We={__name:"Updateprofile",setup(f){const n=z("call"),r=z("auth"),k=re(),b=v(null),D=v({first_name:{label:"First Name",type:"text",required:!0,pattern:/^[A-Za-z]+$/,error_message:"Please enter a valid first name (letters only)",maxLength:100},last_name:{label:"Last Name",type:"text",required:!0,maxLength:100},mobile_number:{label:"Phone No.",type:"text",required:!0,pattern:/^[0-9]{10}$/,error_message:"Invalid phone number ",maxLength:15},custom_country:{label:"Country",type:"select",required:!0},custom_state:{label:"State",type:"select",required:!0},custom_city:{label:"City",type:"select",required:!0},custom_company:{label:"Organization",type:"select",required:!1,readonly:!1},custom_date_of_birth:{label:"Date of Birth",type:"date",required:!0,min:"1900-01-01",max:new Date().toISOString().split("T")[0],max:"maxDate",error_message:"Please select a valid date of birth"},custom_title:{label:"Title",type:"text",placeholder:"Enter your title",required:!1},custom_portfolio:{label:"Portfolio",type:"file",required:!1},custom_cv:{label:"CV",type:"file",required:!1},custom_linkedin:{label:"LinkedIn",type:"text",required:!1}}),t=v({first_name:"",last_name:"",mobile_number:"",custom_country:"",custom_state:"",custom_city:"",custom_company:"",custom_date_of_birth:"",custom_title:"",custom_portfolio:"",custom_cv:"",custom_linkedin:""}),x=oe(()=>{const e=V({},D.value);return t.value.custom_company?e.custom_company.readonly=!0:delete e.custom_company,e}),h=v(new Date().toISOString().split("T")[0]),_=v({}),I=v([]),q=v([]),S=v([]),E=v([]),P=v(!1),A=e=>{e==="custom_portfolio"?document.getElementById("portfolioInput").click():e==="custom_cv"&&document.getElementById("cvInput").click()},M=()=>p(this,null,function*(){const e=yield n("mykartavya.controllers.api.country_data");I.value=e||[]}),R=()=>p(this,null,function*(){if(!t.value.custom_country)return;const e=yield n("mykartavya.controllers.api.state_data",{country:t.value.custom_country});q.value=e||[]}),$=()=>p(this,null,function*(){if(!t.value.custom_state)return;const e=yield n("mykartavya.controllers.api.city_data",{state:t.value.custom_state});S.value=e||[]}),G=()=>p(this,null,function*(){const e=yield n("mykartavya.controllers.api.company_data");E.value=e||[]});T(()=>t.value.custom_country,R),T(()=>t.value.custom_state,$);const J=()=>p(this,null,function*(){try{let e=yield n("mykartavya.controllers.api.sva_user_data");if(e&&e.length>0)t.value=e[0],r.cookie.name=e[0].name,console.log("User details loaded:",e[0]);else throw new Error("Failed to load user details.")}catch(e){console.error("Error fetching user details:",e),m.error("Failed to load user details. Please try again.")}}),W=()=>{var a;_.value={};let e=!0;for(const s in t.value){const o=x.value[s],l=t.value[s];if(o){if(o.required&&!l&&(_.value[s]=`${o.label} is required.`,e=!1,b.value||(b.value=s)),s==="mobile_number"){const u=l==null?void 0:l.trim();(a=o.pattern)!=null&&a.test(u)||((u==null?void 0:u.length)===0?_.value[s]="Phone number is required.":(u==null?void 0:u.length)!==15?_.value[s]="Phone number must be exactly 15 digits.":_.value[s]=o.error_message,e=!1)}s==="first_name"&&o.pattern&&!o.pattern.test(l)&&(_.value[s]=o.error_message,e=!1),s==="last_name"&&l&&o.pattern&&!o.pattern.test(l)&&(_.value[s]=o.error_message,e=!1),s==="custom_date_of_birth"&&(l?new Date(l)>new Date?(_.value[s]="You cannot select a future date.",e=!1):delete _.value[s]:(_.value[s]="Date of birth is required.",e=!1))}}return e},X=()=>p(this,null,function*(){if(!W()){Z();return}P.value=!0;try{let e=yield n("mykartavya.controllers.api.update_sva_user",{data:{name:t.value.name,first_name:t.value.first_name,last_name:t.value.last_name||"",mobile_number:t.value.mobile_number,custom_date_of_birth:t.value.custom_date_of_birth,custom_country:t.value.custom_country,custom_state:t.value.custom_state,custom_city:t.value.custom_city,custom_company:t.value.custom_company||"",custom_title:t.value.custom_title||"",custom_portfolio:t.value.custom_portfolio||"",custom_cv:t.value.custom_cv||"",custom_linkedin:t.value.custom_linkedin||""}});e.status==200?(m.success("Profile updated successfully!",{autoClose:2e3}),setTimeout(()=>k.push("/"),1e3)):m.error(e.message||"Failed to update profile.")}catch(e){m.error("An error occurred while updating the profile.")}finally{P.value=!1}}),Y=e=>{switch(e){case"custom_country":return I.value.map(a=>({name:a.name,label:a.label||a.name}));case"custom_state":return q.value.map(a=>({name:a.name,label:a.state_name||a.name}));case"custom_city":return S.value.map(a=>({name:a.name,label:a.district_name||a.name}));case"custom_company":return E.value.map(a=>({name:a.name,label:a.company_name||a.name}));default:return[]}};se(()=>{M(),G(),J(),localStorage.getItem("updateprofile")=="true"&&(m.error("Please update your profile to continue.",{autoClose:2e3}),localStorage.removeItem("updateprofile"))});const Z=()=>p(this,null,function*(){if(b.value){yield ce();const e=document.querySelector(`[name="${b.value}"]`);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.focus()),b.value=null}}),H=e=>p(this,null,function*(){const a=e.target.files[0];if(!a){m.error("Please select a file.");return}if(!t.value.name){m.error("User document not loaded. Please refresh the page and try again.");return}const s=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],o=5*1024*1024;if(!s.includes(a.type)){m.error("Invalid file type. Only PDF and DOC/DOCX files are allowed.");return}if(a.size>o){m.error("File size exceeds 5 MB limit.");return}const l=new FileReader;l.readAsDataURL(a),l.onload=()=>p(this,null,function*(){try{const u=l.result.split(",")[1],w=yield n("mykartavya.controllers.api.update_sva_user",{data:{name:t.value.name,custom_cv:u}});if(w.status===200)t.value.custom_cv=w.file_url,m.success("CV uploaded successfully!");else throw new Error("Failed to upload CV")}catch(u){console.error("Error uploading CV:",u),m.error(u.message||"Failed to upload CV. Please try again.")}})}),K=e=>p(this,null,function*(){const a=e.target.files[0];if(!a){m.error("Please select a file.");return}if(!t.value.name){m.error("User document not loaded. Please refresh the page and try again.");return}const s=["image/jpeg","image/png","image/webp","application/pdf"],o=5*1024*1024;if(!s.includes(a.type)){m.error("Invalid file type. Only JPG, PNG, WEBP, and PDF are allowed.");return}if(a.size>o){m.error("File size exceeds 5 MB limit.");return}const l=new FileReader;l.readAsDataURL(a),l.onload=()=>p(this,null,function*(){try{const u=l.result.split(",")[1],w=yield n("mykartavya.controllers.api.update_sva_user",{data:{name:t.value.name,custom_portfolio:u}});if(w.status===200)t.value.custom_portfolio=w.file_url,m.success("Portfolio uploaded successfully!");else throw new Error("Failed to upload portfolio")}catch(u){console.error("Error uploading portfolio:",u),m.error(u.message||"Failed to upload portfolio. Please try again.")}})}),Q=(e,a)=>{console.log(`Field ${e} changed to:`,a.target.value)};return(e,a)=>(d(),c("div",me,[i("div",_e,[i("div",pe,[a[1]||(a[1]=i("div",{class:"w-full h-[152px]"},[i("img",{src:de,alt:"Banner",class:"w-full h-full object-cover"})],-1)),i("div",fe,[i("div",ve,[C(r).user_image?(d(),c("img",{key:0,src:C(r).user_image,alt:"Profile",class:"w-full h-full object-cover"},null,8,ye)):(d(),c("div",he,y(C(r).cookie.full_name.charAt(0)),1))])])]),i("div",be,[i("h1",ge,y(C(r).cookie.full_name),1),i("p",xe,y(C(r).cookie.user_id),1)])]),i("div",we,[i("div",Pe,[i("div",null,[a[2]||(a[2]=i("h2",{class:"text-xl font-semibold text-gray-700 mb-4"},"Personal Info",-1)),i("form",{onSubmit:le(X,["prevent"])},[i("div",Ce,[(d(!0),c(L,null,N(x.value,(s,o)=>(d(),c("div",{key:o},[i("label",ke,[O(y(s.label)+" ",1),s.required?(d(),c("span",De,"*")):g("",!0)]),o!=="custom_date_of_birth"&&s.type!=="select"&&s.type!=="file"?F((d(),c("input",{key:0,"onUpdate:modelValue":l=>t.value[o]=l,type:s.type,name:o,placeholder:s.placeholder,readonly:s.readonly,maxlength:s.maxLength,class:j(["block w-full border border-gray-300 text-bodyh2 rounded py-2 px-3 focus:outline-none focus:ring focus:ring-orange-200",{"bg-gray-100":s.readonly}]),onChange:l=>Q(o,l)},null,42,Fe)),[[ne,t.value[o]]]):o==="custom_date_of_birth"?F((d(),c("input",{key:1,"onUpdate:modelValue":a[0]||(a[0]=l=>t.value.custom_date_of_birth=l),type:"date",name:"custom_date_of_birth",max:h.value,class:"block w-full border border-gray-300 text-bodyh2 rounded py-2 px-3 focus:outline-none focus:ring focus:ring-orange-200"},null,8,Ie)),[[ie,t.value.custom_date_of_birth]]):s.type==="file"?(d(),c("div",qe,[o==="custom_portfolio"?(d(),c("input",{key:0,type:"file",id:"portfolioInput",name:o,onChange:K,class:"hidden"},null,40,Se)):g("",!0),o==="custom_cv"?(d(),c("input",{key:1,type:"file",id:"cvInput",name:o,onChange:H,class:"hidden"},null,40,Ee)):g("",!0),i("div",Ue,[i("button",{type:"button",onClick:l=>A(o),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-sm transition"},y(t.value[o]?"Change File":"Upload File"),9,Be),t.value[o]?(d(),c("span",Ve,y(t.value[o].split("/").pop()),1)):g("",!0)])])):g("",!0),s.type==="select"?F((d(),c("select",{key:3,"onUpdate:modelValue":l=>t.value[o]=l,name:o,disabled:s.readonly,class:j(["block w-full border border-gray-300 text-bodyh2 rounded py-2 px-3 focus:outline-none focus:ring focus:ring-orange-200",{"bg-gray-100":s.readonly}])},[i("option",ze,"Select "+y(s.label),1),(d(!0),c(L,null,N(Y(o),l=>(d(),c("option",{key:l.name,value:l.name},y(l.label||l.name),9,Le))),128))],10,Te)),[[ue,t.value[o]]]):g("",!0),_.value[o]?(d(),c("p",Ne,y(_.value[o]),1)):g("",!0)]))),128))]),i("div",Oe,[i("button",{type:"submit",class:"bg-orange-500 text-white font-semibold py-2 px-4 rounded-sm hover:bg-orange-600 transition flex items-center justify-center min-w-[100px]",disabled:P.value},[P.value?(d(),c("span",Ae)):g("",!0),O(" "+y(P.value?"UPDATING...":"UPDATE"),1)],8,je)])],32)])])])]))}};export{We as default};
