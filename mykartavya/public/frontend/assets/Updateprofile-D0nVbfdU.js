var ee=Object.defineProperty;var T=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var N=(g,i,n)=>i in g?ee(g,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):g[i]=n,V=(g,i)=>{for(var n in i||(i={}))te.call(i,n)&&N(g,n,i[n]);if(T)for(var n of T(i))ae.call(i,n)&&N(g,n,i[n]);return g};var _=(g,i,n)=>new Promise((F,y)=>{var C=f=>{try{x(n.next(f))}catch(d){y(d)}},o=f=>{try{x(n.throw(f))}catch(d){y(d)}},x=f=>f.done?F(f.value):Promise.resolve(f.value).then(C,o);x((n=n.apply(g,i)).next())});import{r as p,s as oe,l as z,o as se,c as u,a,t as v,u as S,i as I,n as j,D as le,F as E,h as L,m as w,f as q,B as re,j as c,v as D,ad as ne,x as ie,ae as ue,a2 as ce}from"./index-spPKNqFh.js";import{_ as de}from"./Rectangle-Cxb5RPqE.js";import{l as h}from"./index-Bh2WMTeQ.js";/* empty css              */const me={class:"max-w-[1920px] mx-auto px-10 pt-[82px] pb-4 bg-gray-50"},_e={class:"h-[261px] rounded-b-md bg-white"},pe={class:"relative"},ve={class:"w-full h-[152px] relative"},ge=["src"],he={key:1,src:de,alt:"Banner",class:"w-full h-full object-cover"},fe={class:"absolute bottom-4 right-4 bg-white/90 hover:bg-white px-3 py-1.5 rounded-md shadow-sm cursor-pointer flex items-center space-x-2 transition-all"},ye={class:"absolute left-8 -bottom-8"},be={class:"relative"},xe={class:"w-32 h-32 rounded-full border-4 border-white overflow-hidden"},we=["src"],ke={key:1,class:"w-full h-full bg-gray-200 flex items-center justify-center text-[40px] text-gray-600"},Ce={class:"absolute bottom-0 right-0 bg-white rounded-full p-1.5 shadow-md cursor-pointer hover:bg-gray-50 transition-all"},Fe={class:"pt-10 px-4"},Pe={class:"flex justify-between items-center"},Se={class:"text-3xl font-medium"},je={class:"text-bodyh1 text-gray-600 mt-1"},qe={class:"flex items-center space-x-2"},De={class:"bg-white rounded-lg shadow mt-4"},Me={class:"p-6"},Ae={class:"grid grid-cols-1 md:grid-cols-2 gap-8"},Be={class:"block text-bodyh1 font-normal text-gray-700 mb-2"},Ue={key:0,class:"text-red-500"},Te=["onUpdate:modelValue","type","name","placeholder","readonly","maxlength","onChange"],Ne=["max"],Ve={key:2,class:"flex flex-col"},ze={class:"flex items-center px-4 py-3 bg-white rounded-lg shadow-sm border-2 border-dashed border-gray-300 cursor-pointer hover:bg-gray-50 transition"},Ie={class:"text-sm text-gray-600"},Ee=["onChange"],Le={key:0,class:"mt-2 p-4 bg-gray-50 rounded-lg border border-gray-200"},He={class:"flex items-center justify-between"},Oe={class:"flex items-center space-x-3"},Re={class:"text-sm text-gray-600"},$e=["onClick"],Ge=["onUpdate:modelValue","name","disabled"],We={value:"",disabled:""},Je=["value"],Ye={key:4,class:"text-red-500 text-[11px] mt-1"},Ze={class:"mt-8 flex justify-start"},Ke=["disabled"],Qe={key:0,class:"inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"},lt={__name:"Updateprofile",setup(g){const i=I("call"),n=I("auth"),F=re(),y=p(null),C=p({first_name:{label:"First Name",type:"text",required:!0,pattern:/^[A-Za-z]+$/,error_message:"Please enter a valid first name (letters only)",maxLength:100},last_name:{label:"Last Name",type:"text",required:!0,maxLength:100},mobile_number:{label:"Phone No.",type:"text",required:!0,pattern:/^[0-9]{10}$/,error_message:"Invalid phone number ",maxLength:15},custom_country:{label:"Country",type:"select",required:!0},custom_state:{label:"State",type:"select",required:!0},custom_city:{label:"City",type:"select",required:!0},custom_company:{label:"Organization",type:"select",required:!1,readonly:!1},custom_date_of_birth:{label:"Date of Birth",type:"date",required:!0,min:"1900-01-01",max:new Date().toISOString().split("T")[0],max:"maxDate",error_message:"Please select a valid date of birth"},custom_gender:{label:"Gender",type:"select",required:!0,options:[{name:"Male",label:"Male"},{name:"Female",label:"Female"},{name:"Other",label:"Other"}]},custom_title:{label:"Title",type:"text",placeholder:"Enter your title",required:!1},custom_linkedin:{label:"LinkedIn",type:"text",required:!1},custom_cv:{label:"CV",type:"file",required:!1},custom_portfolio:{label:"Portfolio",type:"file",required:!1}}),o=p({first_name:"",last_name:"",mobile_number:"",custom_country:"",custom_state:"",custom_city:"",custom_company:"",custom_date_of_birth:"",custom_title:"",custom_linkedin:"",custom_cv:"",custom_portfolio:"",custom_gender:""}),x=oe(()=>{const t=V({},C.value);return o.value.custom_company?t.custom_company.readonly=!0:delete t.custom_company,t}),f=p(new Date().toISOString().split("T")[0]),d=p({}),M=p([]),A=p([]),B=p([]),U=p([]),k=p(!1),b=p(""),H=()=>_(this,null,function*(){const t=yield i("mykartavya.controllers.api.country_data");M.value=t||[]}),O=()=>_(this,null,function*(){if(!o.value.custom_country)return;const t=yield i("mykartavya.controllers.api.state_data",{country:o.value.custom_country});A.value=t||[]}),R=()=>_(this,null,function*(){if(!o.value.custom_state)return;const t=yield i("mykartavya.controllers.api.city_data",{state:o.value.custom_state});B.value=t||[]}),$=()=>_(this,null,function*(){const t=yield i("mykartavya.controllers.api.company_data");U.value=t||[]});z(()=>o.value.custom_country,O),z(()=>o.value.custom_state,R);const G=()=>_(this,null,function*(){try{let t=yield i("mykartavya.controllers.api.sva_user_data");if(t&&t.length>0)o.value=t[0],b.value=t[0].workflow_state||"Not Set",n.cookie.name=t[0].name,console.log("User details loaded:",t[0]),console.log("Workflow state:",b.value);else throw new Error("Failed to load user details.")}catch(t){console.error("Error fetching user details:",t),h.error("Failed to load user details. Please try again.")}}),W=()=>{var e;d.value={};let t=!0;for(const s in o.value){const l=x.value[s],r=o.value[s];if(l){if(l.required&&!r&&(d.value[s]=`${l.label} is required.`,t=!1,y.value||(y.value=s)),s==="mobile_number"){const m=r==null?void 0:r.trim();(e=l.pattern)!=null&&e.test(m)||((m==null?void 0:m.length)===0?d.value[s]="Phone number is required.":(m==null?void 0:m.length)!==15?d.value[s]="Phone number must be exactly 15 digits.":d.value[s]=l.error_message,t=!1)}s==="first_name"&&l.pattern&&!l.pattern.test(r)&&(d.value[s]=l.error_message,t=!1),s==="last_name"&&r&&l.pattern&&!l.pattern.test(r)&&(d.value[s]=l.error_message,t=!1),s==="custom_date_of_birth"&&(r?new Date(r)>new Date?(d.value[s]="You cannot select a future date.",t=!1):delete d.value[s]:(d.value[s]="Date of birth is required.",t=!1))}}return t},J=()=>_(this,null,function*(){if(!W()){Z();return}k.value=!0;try{const t={name:o.value.name,first_name:o.value.first_name,last_name:o.value.last_name||"",mobile_number:o.value.mobile_number,custom_date_of_birth:o.value.custom_date_of_birth,custom_country:o.value.custom_country,custom_state:o.value.custom_state,custom_city:o.value.custom_city,custom_company:o.value.custom_company||"",custom_title:o.value.custom_title||"",custom_linkedin:o.value.custom_linkedin||"",custom_portfolio:o.value.custom_portfolio||"",custom_cv:o.value.custom_cv||"",custom_gender:o.value.custom_gender,user_image:o.value.user_image||"",custom_background_image:o.value.custom_background_image||""};let e=yield i("mykartavya.controllers.api.update_sva_user",{data:t});if(e.status===200)h.success("Profile updated successfully!",{autoClose:2e3}),setTimeout(()=>F.push("/"),1e3);else throw new Error(e.message||"Failed to update profile")}catch(t){console.error("Error in form submission:",t),h.error(t.message||"An error occurred while updating the profile.",{autoClose:2e3})}finally{k.value=!1}}),Y=t=>{switch(t){case"custom_country":return M.value.map(e=>({name:e.name,label:e.label||e.name}));case"custom_state":return A.value.map(e=>({name:e.name,label:e.state_name||e.name}));case"custom_city":return B.value.map(e=>({name:e.name,label:e.district_name||e.name}));case"custom_company":return U.value.map(e=>({name:e.name,label:e.company_name||e.name}));case"custom_gender":return C.value.custom_gender.options;default:return[]}};se(()=>_(this,null,function*(){H(),$(),G(),localStorage.getItem("updateprofile")=="true"&&(h.error("Please update your profile to continue.",{autoClose:2e3}),localStorage.removeItem("updateprofile"))}));const Z=()=>_(this,null,function*(){if(y.value){yield ce();const t=document.querySelector(`[name="${y.value}"]`);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.focus()),y.value=null}}),K=(t,e)=>{console.log(`Field ${t} changed to:`,e.target.value)},P=(t,e)=>_(this,null,function*(){const s=t.target.files[0];if(!s){h.error("Please select a file.",{autoClose:2e3});return}const l=5*1024*1024;if(s.size>l){h.error("File size exceeds 5 MB limit.",{autoClose:2e3});return}if((e==="user_image"||e==="custom_background_image")&&!["image/jpeg","image/png","image/webp"].includes(s.type)){h.error("Please upload a valid image file (JPG, PNG, or WEBP)",{autoClose:2e3});return}const r=new FileReader;r.readAsDataURL(s),r.onload=()=>_(this,null,function*(){try{const m=r.result.split(",")[1];o.value[e]=m,h.success("File uploaded successfully!",{autoClose:2e3})}catch(m){console.error("Error uploading file:",m),h.error("Failed to upload file. Please try again.",{autoClose:2e3})}})}),Q=t=>{o.value[t]=null,h.info("File removed.",{autoClose:2e3})},X=t=>t?t.startsWith("data:")?"Image File":"Uploaded File":"";return(t,e)=>(c(),u("div",me,[a("div",_e,[a("div",pe,[a("div",ve,[o.value.custom_background_image?(c(),u("img",{key:0,src:o.value.custom_background_image,alt:"Banner",class:"w-full h-full object-cover"},null,8,ge)):(c(),u("img",he)),a("label",fe,[e[3]||(e[3]=a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1)),e[4]||(e[4]=a("span",{class:"text-sm text-gray-600"},"Change Cover",-1)),a("input",{type:"file",class:"hidden",onChange:e[0]||(e[0]=s=>P(s,"custom_background_image")),accept:"image/*"},null,32)])]),a("div",ye,[a("div",be,[a("div",xe,[o.value.user_image?(c(),u("img",{key:0,src:o.value.user_image,alt:"Profile",class:"w-full h-full object-cover"},null,8,we)):(c(),u("div",ke,v(S(n).cookie.full_name.charAt(0).toUpperCase()),1))]),a("label",Ce,[e[5]||(e[5]=a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1)),a("input",{type:"file",class:"hidden",onChange:e[1]||(e[1]=s=>P(s,"user_image")),accept:"image/*"},null,32)])])])]),a("div",Fe,[a("div",Pe,[a("div",null,[a("h1",Se,v(S(n).cookie.full_name),1),a("p",je,v(S(n).cookie.user_id),1)]),a("div",qe,[e[6]||(e[6]=a("span",{class:"text-sm text-gray-500"},"Status:",-1)),a("span",{class:j(["px-3 py-1 text-sm font-medium rounded-full",{"bg-green-100 text-green-800":b.value==="Approved","bg-yellow-100 text-yellow-800":b.value==="Pending Approval","bg-red-100 text-red-800":b.value==="Rejected","bg-gray-100 text-gray-800":!b.value||b.value==="Not Set"}])},v(b.value||"Not Set"),3)])])])]),a("div",De,[a("div",Me,[a("div",null,[e[10]||(e[10]=a("h2",{class:"text-xl font-semibold text-gray-700 mb-6"},"Personal Info",-1)),a("form",{onSubmit:le(J,["prevent"])},[a("div",Ae,[(c(!0),u(E,null,L(x.value,(s,l)=>(c(),u("div",{key:l,class:"min-w-[300px]"},[a("label",Be,[q(v(s.label)+" ",1),s.required?(c(),u("span",Ue,"*")):w("",!0)]),l!=="custom_date_of_birth"&&s.type!=="select"&&s.type!=="file"?D((c(),u("input",{key:0,"onUpdate:modelValue":r=>o.value[l]=r,type:s.type,name:l,placeholder:s.placeholder,readonly:s.readonly,maxlength:s.maxLength,class:j(["block w-full border border-gray-300 text-bodyh2 rounded py-2.5 px-4 focus:outline-none focus:ring focus:ring-orange-200",{"bg-gray-100":s.readonly}]),onChange:r=>K(l,r)},null,42,Te)),[[ne,o.value[l]]]):l==="custom_date_of_birth"?D((c(),u("input",{key:1,"onUpdate:modelValue":e[2]||(e[2]=r=>o.value.custom_date_of_birth=r),type:"date",name:"custom_date_of_birth",max:f.value,class:"block w-full border border-gray-300 text-bodyh2 rounded py-2.5 px-4 focus:outline-none focus:ring focus:ring-orange-200"},null,8,Ne)),[[ie,o.value.custom_date_of_birth]]):s.type==="file"?(c(),u("div",Ve,[a("label",ze,[e[7]||(e[7]=a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-indigo-500 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),a("span",Ie,v(o.value[l]?"Change File":"Upload File"),1),a("input",{type:"file",class:"hidden",onChange:r=>P(r,l),accept:"*/*"},null,40,Ee)]),o.value[l]?(c(),u("div",Le,[a("div",He,[a("div",Oe,[e[8]||(e[8]=a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),a("span",Re,v(X(o.value[l])),1)]),a("button",{onClick:r=>Q(l),class:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-white bg-red-500 rounded-md hover:bg-red-600 transition-colors duration-200"},e[9]||(e[9]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),q(" Remove ")]),8,$e)])])):w("",!0)])):w("",!0),s.type==="select"?D((c(),u("select",{key:3,"onUpdate:modelValue":r=>o.value[l]=r,name:l,disabled:s.readonly,class:j(["block w-full border border-gray-300 text-bodyh2 rounded py-2.5 px-4 focus:outline-none focus:ring focus:ring-orange-200",{"bg-gray-100":s.readonly}])},[a("option",We,"Select "+v(s.label),1),(c(!0),u(E,null,L(Y(l),r=>(c(),u("option",{key:r.name,value:r.name},v(r.label||r.name),9,Je))),128))],10,Ge)),[[ue,o.value[l]]]):w("",!0),d.value[l]?(c(),u("p",Ye,v(d.value[l]),1)):w("",!0)]))),128))]),a("div",Ze,[a("button",{type:"submit",class:"bg-orange-500 text-white font-semibold py-2.5 px-8 rounded-sm hover:bg-orange-600 transition flex items-center justify-center min-w-[120px]",disabled:k.value},[k.value?(c(),u("span",Qe)):w("",!0),q(" "+v(k.value?"UPDATING...":"UPDATE"),1)],8,Ke)])],32)])])])]))}};export{lt as default};
