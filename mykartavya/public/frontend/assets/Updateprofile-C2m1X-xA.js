var K=Object.defineProperty;var E=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var U=(f,n,l)=>n in f?K(f,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):f[n]=l,B=(f,n)=>{for(var l in n||(n={}))Q.call(n,l)&&U(f,l,n[l]);if(E)for(var l of E(n))ee.call(n,l)&&U(f,l,n[l]);return f};var _=(f,n,l)=>new Promise((P,g)=>{var F=y=>{try{x(l.next(y))}catch(d){g(d)}},t=y=>{try{x(l.throw(y))}catch(d){g(d)}},x=y=>y.done?P(y.value):Promise.resolve(y.value).then(F,t);x((l=l.apply(f,n)).next())});import{r as v,s as te,l as V,o as ae,c as m,a as i,u as C,i as L,t as h,D as oe,F as T,h as z,B as se,j as p,v as D,m as b,f as re,ad as le,n as M,x as ne,ae as ie,a2 as ue}from"./index-CGbfoD3N.js";import{_ as ce}from"./Rectangle-Cxb5RPqE.js";import{l as c}from"./index-_uNVIEKw.js";/* empty css              */const de={class:"max-w-[1920px] mx-auto px-10 pt-[82px] pb-4 bg-gray-50"},me={class:"h-[261px] rounded-b-md bg-white"},pe={class:"relative"},_e={class:"absolute left-8 -bottom-8"},fe={class:"w-32 h-32 rounded-full border-4 border-white overflow-hidden"},ye=["src"],ve={key:1,class:"w-full h-full bg-gray-200 flex items-center justify-center text-[40px] text-gray-600"},he={class:"pt-10 px-4"},ge={class:"text-3xl font-medium"},be={class:"text-bodyh1 text-gray-600 mt-1"},xe={class:"bg-white rounded-lg shadow mt-4"},we={class:"p-6"},Ce={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Pe={class:"block text-bodyh1 font-normal text-gray-700 mb-1"},Fe={key:0,class:"text-red-500 pt-2"},De=["onUpdate:modelValue","type","name","placeholder","readonly","maxlength","onChange"],ke=["max"],qe={key:2,class:"flex flex-col"},Ie=["name"],Se=["name"],Ee={class:"flex items-center"},Ue=["onClick"],Be={key:0,class:"ml-2 text-sm text-gray-600 truncate max-w-xs"},Ve=["onUpdate:modelValue","name","disabled"],Le={value:"",disabled:""},Te=["value"],ze={key:4,class:"text-red-500 text-[11px] mt-1"},Re={__name:"Updateprofile",setup(f){const n=L("call"),l=L("auth"),P=se(),g=v(null),F=v({first_name:{label:"First Name",type:"text",required:!0,pattern:/^[A-Za-z]+$/,error_message:"Please enter a valid first name (letters only)",maxLength:100},last_name:{label:"Last Name",type:"text",required:!0,maxLength:100},mobile_number:{label:"Phone No.",type:"text",required:!0,pattern:/^[0-9]{10}$/,error_message:"Invalid phone number ",maxLength:15},custom_country:{label:"Country",type:"select",required:!0},custom_state:{label:"State",type:"select",required:!0},custom_city:{label:"City",type:"select",required:!0},custom_company:{label:"Company",type:"select",required:!1,readonly:!1},custom_date_of_birth:{label:"Date of Birth",type:"date",required:!0,min:"1900-01-01",max:new Date().toISOString().split("T")[0],max:"maxDate",error_message:"Please select a valid date of birth"},custom_title:{label:"Title",type:"text",placeholder:"Enter your title",required:!1},custom_portfolio:{label:"Portfolio",type:"file",required:!1},custom_cv:{label:"CV",type:"file",required:!1},custom_linkedin:{label:"LinkedIn",type:"text",required:!1}}),t=v({first_name:"",last_name:"",mobile_number:"",custom_country:"",custom_state:"",custom_city:"",custom_company:"",custom_date_of_birth:"",custom_title:"",custom_portfolio:"",custom_cv:"",custom_linkedin:""}),x=te(()=>{const e=B({},F.value);return t.value.custom_company?e.custom_company.readonly=!0:delete e.custom_company,e}),y=v(new Date().toISOString().split("T")[0]),d=v({}),k=v([]),q=v([]),I=v([]),S=v([]),N=e=>{e==="custom_portfolio"?document.getElementById("portfolioInput").click():e==="custom_cv"&&document.getElementById("cvInput").click()},O=()=>_(this,null,function*(){const e=yield n("mykartavya.controllers.api.country_data");k.value=e||[]}),j=()=>_(this,null,function*(){if(!t.value.custom_country)return;const e=yield n("mykartavya.controllers.api.state_data",{country:t.value.custom_country});q.value=e||[]}),A=()=>_(this,null,function*(){if(!t.value.custom_state)return;const e=yield n("mykartavya.controllers.api.city_data",{state:t.value.custom_state});I.value=e||[]}),R=()=>_(this,null,function*(){const e=yield n("mykartavya.controllers.api.company_data");S.value=e||[]});V(()=>t.value.custom_country,j),V(()=>t.value.custom_state,A);const $=()=>_(this,null,function*(){try{let e=yield n("mykartavya.controllers.api.sva_user_data");if(e&&e.length>0)t.value=e[0],l.cookie.name=e[0].name,console.log("User details loaded:",e[0]);else throw new Error("Failed to load user details.")}catch(e){console.error("Error fetching user details:",e),c.error("Failed to load user details. Please try again.")}}),G=()=>{var a;d.value={};let e=!0;for(const s in t.value){const o=x.value[s],r=t.value[s];if(o){if(o.required&&!r&&(d.value[s]=`${o.label} is required.`,e=!1,g.value||(g.value=s)),s==="mobile_number"){const u=r==null?void 0:r.trim();(a=o.pattern)!=null&&a.test(u)||((u==null?void 0:u.length)===0?d.value[s]="Phone number is required.":(u==null?void 0:u.length)!==10?d.value[s]="Phone number must be exactly 10 digits.":d.value[s]=o.error_message,e=!1)}s==="first_name"&&o.pattern&&!o.pattern.test(r)&&(d.value[s]=o.error_message,e=!1),s==="last_name"&&r&&o.pattern&&!o.pattern.test(r)&&(d.value[s]=o.error_message,e=!1),s==="custom_date_of_birth"&&(r?new Date(r)>new Date?(d.value[s]="You cannot select a future date.",e=!1):delete d.value[s]:(d.value[s]="Date of birth is required.",e=!1))}}return e},J=()=>_(this,null,function*(){if(!G()){X();return}try{let e=yield n("mykartavya.controllers.api.update_sva_user",{data:{name:t.value.name,first_name:t.value.first_name,last_name:t.value.last_name||"",mobile_number:t.value.mobile_number,custom_date_of_birth:t.value.custom_date_of_birth,custom_country:t.value.custom_country,custom_state:t.value.custom_state,custom_city:t.value.custom_city,custom_company:t.value.custom_company||"",custom_title:t.value.custom_title||"",custom_portfolio:t.value.custom_portfolio||"",custom_cv:t.value.custom_cv||"",custom_linkedin:t.value.custom_linkedin||""}});e.status==200?(c.success("Profile updated successfully!",{autoClose:3e3}),setTimeout(()=>P.push("/"),3e3)):c.error(e.message||"Failed to update profile.")}catch(e){c.error("An error occurred while updating the profile.")}}),W=e=>{switch(e){case"custom_country":return k.value.map(a=>({name:a.name,label:a.label||a.name}));case"custom_state":return q.value.map(a=>({name:a.name,label:a.state_name||a.name}));case"custom_city":return I.value.map(a=>({name:a.name,label:a.district_name||a.name}));case"custom_company":return S.value.map(a=>({name:a.name,label:a.company_name||a.name}));default:return[]}};ae(()=>{O(),R(),$(),localStorage.getItem("updateprofile")=="true"&&(c.error("Please update your profile to continue.",{autoClose:3e3}),localStorage.removeItem("updateprofile"))});const X=()=>_(this,null,function*(){if(g.value){yield ue();const e=document.querySelector(`[name="${g.value}"]`);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.focus()),g.value=null}}),Y=e=>_(this,null,function*(){const a=e.target.files[0];if(!a){c.error("Please select a file.");return}if(!t.value.name){c.error("User document not loaded. Please refresh the page and try again.");return}const s=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],o=5*1024*1024;if(!s.includes(a.type)){c.error("Invalid file type. Only PDF and DOC/DOCX files are allowed.");return}if(a.size>o){c.error("File size exceeds 5 MB limit.");return}const r=new FileReader;r.readAsDataURL(a),r.onload=()=>_(this,null,function*(){try{const u=r.result.split(",")[1],w=yield n("mykartavya.controllers.api.update_sva_user",{data:{name:t.value.name,custom_cv:u}});if(w.status===200)t.value.custom_cv=w.file_url,c.success("CV uploaded successfully!");else throw new Error("Failed to upload CV")}catch(u){console.error("Error uploading CV:",u),c.error(u.message||"Failed to upload CV. Please try again.")}})}),Z=e=>_(this,null,function*(){const a=e.target.files[0];if(!a){c.error("Please select a file.");return}if(!t.value.name){c.error("User document not loaded. Please refresh the page and try again.");return}const s=["image/jpeg","image/png","image/webp","application/pdf"],o=5*1024*1024;if(!s.includes(a.type)){c.error("Invalid file type. Only JPG, PNG, WEBP, and PDF are allowed.");return}if(a.size>o){c.error("File size exceeds 5 MB limit.");return}const r=new FileReader;r.readAsDataURL(a),r.onload=()=>_(this,null,function*(){try{const u=r.result.split(",")[1],w=yield n("mykartavya.controllers.api.update_sva_user",{data:{name:t.value.name,custom_portfolio:u}});if(w.status===200)t.value.custom_portfolio=w.file_url,c.success("Portfolio uploaded successfully!");else throw new Error("Failed to upload portfolio")}catch(u){console.error("Error uploading portfolio:",u),c.error(u.message||"Failed to upload portfolio. Please try again.")}})}),H=(e,a)=>{console.log(`Field ${e} changed to:`,a.target.value)};return(e,a)=>(p(),m("div",de,[i("div",me,[i("div",pe,[a[1]||(a[1]=i("div",{class:"w-full h-[152px]"},[i("img",{src:ce,alt:"Banner",class:"w-full h-full object-cover"})],-1)),i("div",_e,[i("div",fe,[C(l).user_image?(p(),m("img",{key:0,src:C(l).user_image,alt:"Profile",class:"w-full h-full object-cover"},null,8,ye)):(p(),m("div",ve,h(C(l).cookie.full_name.charAt(0)),1))])])]),i("div",he,[i("h1",ge,h(C(l).cookie.full_name),1),i("p",be,h(C(l).cookie.user_id),1)])]),i("div",xe,[i("div",we,[i("div",null,[a[3]||(a[3]=i("h2",{class:"text-xl font-semibold text-gray-700 mb-4"},"Personal Info",-1)),i("form",{onSubmit:oe(J,["prevent"])},[i("div",Ce,[(p(!0),m(T,null,z(x.value,(s,o)=>(p(),m("div",{key:o},[i("label",Pe,[re(h(s.label)+" ",1),s.required?(p(),m("span",Fe,"*")):b("",!0)]),o!=="custom_date_of_birth"&&s.type!=="select"&&s.type!=="file"?D((p(),m("input",{key:0,"onUpdate:modelValue":r=>t.value[o]=r,type:s.type,name:o,placeholder:s.placeholder,readonly:s.readonly,maxlength:s.maxLength,class:M(["block w-full border border-gray-300 text-bodyh2 rounded py-2 px-3 focus:outline-none focus:ring focus:ring-orange-200",{"bg-gray-100":s.readonly}]),onChange:r=>H(o,r)},null,42,De)),[[le,t.value[o]]]):o==="custom_date_of_birth"?D((p(),m("input",{key:1,"onUpdate:modelValue":a[0]||(a[0]=r=>t.value.custom_date_of_birth=r),type:"date",name:"custom_date_of_birth",max:y.value,class:"block w-full border border-gray-300 text-bodyh2 rounded py-2 px-3 focus:outline-none focus:ring focus:ring-orange-200"},null,8,ke)),[[ne,t.value.custom_date_of_birth]]):s.type==="file"?(p(),m("div",qe,[o==="custom_portfolio"?(p(),m("input",{key:0,type:"file",id:"portfolioInput",name:o,onChange:Z,class:"hidden"},null,40,Ie)):b("",!0),o==="custom_cv"?(p(),m("input",{key:1,type:"file",id:"cvInput",name:o,onChange:Y,class:"hidden"},null,40,Se)):b("",!0),i("div",Ee,[i("button",{type:"button",onClick:r=>N(o),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-sm transition"},h(t.value[o]?"Change File":"Upload File"),9,Ue),t.value[o]?(p(),m("span",Be,h(t.value[o].split("/").pop()),1)):b("",!0)])])):b("",!0),s.type==="select"?D((p(),m("select",{key:3,"onUpdate:modelValue":r=>t.value[o]=r,name:o,disabled:s.readonly,class:M(["block w-full border border-gray-300 text-bodyh2 rounded py-2 px-3 focus:outline-none focus:ring focus:ring-orange-200",{"bg-gray-100":s.readonly}])},[i("option",Le,"Select "+h(s.label),1),(p(!0),m(T,null,z(W(o),r=>(p(),m("option",{key:r.name,value:r.name},h(r.label||r.name),9,Te))),128))],10,Ve)),[[ie,t.value[o]]]):b("",!0),d.value[o]?(p(),m("p",ze,h(d.value[o]),1)):b("",!0)]))),128))]),a[2]||(a[2]=i("div",{class:"mt-6"},[i("button",{type:"submit",class:"bg-orange-500 text-white font-semibold py-2 px-4 rounded-sm hover:bg-orange-600 transition"}," UPDATE ")],-1))],32)])])])]))}};export{Re as default};
