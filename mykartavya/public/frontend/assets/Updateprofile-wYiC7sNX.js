var K=Object.defineProperty;var P=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var V=(d,r,l)=>r in d?K(d,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):d[r]=l,U=(d,r)=>{for(var l in r||(r={}))Q.call(r,l)&&V(d,l,r[l]);if(P)for(var l of P(r))W.call(r,l)&&V(d,l,r[l]);return d};var _=(d,r,l)=>new Promise((k,v)=>{var C=p=>{try{x(l.next(p))}catch(u){v(u)}},a=p=>{try{x(l.throw(p))}catch(u){v(u)}},x=p=>p.done?k(p.value):Promise.resolve(p.value).then(C,a);x((l=l.apply(d,r)).next())});import{r as f,s as X,l as T,o as ee,c as i,a as c,u as w,i as B,t as y,D as te,F as A,h as E,B as oe,j as m,v as D,m as g,f as ae,ad as se,n as N,x as le,ae as re,a2 as ne}from"./index-vne65Zvs.js";import{_ as ce}from"./Rectangle-Cxb5RPqE.js";import{l as h}from"./index-DOFOvpg4.js";/* empty css              */const ue={class:"max-w-[1920px] mx-auto px-10 pt-[82px] pb-4 bg-gray-50"},ie={class:"h-[261px] rounded-b-md bg-white"},me={class:"relative"},de={class:"absolute left-8 -bottom-8"},_e={class:"w-32 h-32 rounded-full border-4 border-white overflow-hidden"},pe=["src"],fe={key:1,class:"w-full h-full bg-gray-200 flex items-center justify-center text-[40px] text-gray-600"},ye={class:"pt-10 px-4"},ve={class:"text-3xl font-medium"},be={class:"text-bodyh1 text-gray-600 mt-1"},he={class:"bg-white rounded-lg shadow mt-4"},ge={class:"p-6"},xe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},we={class:"block text-bodyh1 font-normal text-gray-700 mb-1"},ke={key:0,class:"text-red-500 pt-2"},Ce=["onUpdate:modelValue","type","name","placeholder","readonly"],De=["max"],qe={key:2,class:"flex flex-col"},Se=["name"],Fe=["name"],Ie={class:"flex items-center"},Pe=["onClick"],Ve={key:0,class:"ml-2 text-sm text-gray-600 truncate max-w-xs"},Ue=["onUpdate:modelValue","name","disabled"],Te={value:"",disabled:""},Be=["value"],Ae={key:4,class:"text-red-500 text-[11px] mt-1"},Oe={__name:"Updateprofile",setup(d){const r=B("call"),l=B("auth"),k=oe(),v=f(null),C=f({first_name:{label:"First Name",type:"text",required:!0,pattern:/^[A-Za-z]+$/,error_message:"Please enter a valid first name (letters only)"},last_name:{label:"Last Name",type:"text",required:!1},mobile_number:{label:"Phone No.",type:"text",required:!0,pattern:/^[0-9]{10}$/,error_message:"Invalid phone number "},custom_country:{label:"Country",type:"select",required:!0},custom_state:{label:"State",type:"select",required:!0},custom_city:{label:"City",type:"select",required:!0},custom_company:{label:"Company",type:"select",required:!1,readonly:!1},custom_date_of_birth:{label:"Date of Birth",type:"date",required:!0,min:"1900-01-01",max:new Date().toISOString().split("T")[0],max:"maxDate",error_message:"Please select a valid date of birth"},custom_title:{label:"Title",type:"text",placeholder:"Enter your title",required:!1},custom_portfolio:{label:"Portfolio",type:"file",required:!1},custom_cv:{label:"CV",type:"file",required:!1},custom_linkedin:{label:"LinkedIn",type:"text",required:!1}}),a=f({first_name:"",last_name:"",mobile_number:"",custom_country:"",custom_state:"",custom_city:"",custom_company:"",custom_date_of_birth:"",custom_title:"",custom_portfolio:"",custom_cv:"",custom_linkedin:""}),x=X(()=>{const t=U({},C.value);return a.value.custom_company?t.custom_company.readonly=!0:delete t.custom_company,t}),p=f(new Date().toISOString().split("T")[0]),u=f({}),q=f([]),S=f([]),F=f([]),I=f([]),j=t=>{t==="custom_portfolio"?document.getElementById("portfolioInput").click():t==="custom_cv"&&document.getElementById("cvInput").click()},M=()=>_(this,null,function*(){const t=yield r("mykartavya.controllers.api.country_data");q.value=t||[]}),$=()=>_(this,null,function*(){if(!a.value.custom_country)return;const t=yield r("mykartavya.controllers.api.state_data",{country:a.value.custom_country});S.value=t||[]}),L=()=>_(this,null,function*(){if(!a.value.custom_state)return;const t=yield r("mykartavya.controllers.api.city_data",{state:a.value.custom_state});F.value=t||[]}),O=()=>_(this,null,function*(){const t=yield r("mykartavya.controllers.api.company_data");I.value=t||[]});T(()=>a.value.custom_country,$),T(()=>a.value.custom_state,L);const z=()=>_(this,null,function*(){let t=yield r("mykartavya.controllers.api.sva_user_data");t&&t.length>0&&(a.value=t[0])}),R=()=>{var s;u.value={};let t=!0;for(const e in a.value){const o=x.value[e],n=a.value[e];if(o){if(o.required&&!n&&(u.value[e]=`${o.label} is required.`,t=!1,v.value||(v.value=e)),e==="mobile_number"){const b=n==null?void 0:n.trim();(s=o.pattern)!=null&&s.test(b)||((b==null?void 0:b.length)===0?u.value[e]="Phone number is required.":(b==null?void 0:b.length)!==10?u.value[e]="Phone number must be exactly 10 digits.":u.value[e]=o.error_message,t=!1)}e==="first_name"&&o.pattern&&!o.pattern.test(n)&&(u.value[e]=o.error_message,t=!1),e==="last_name"&&n&&o.pattern&&!o.pattern.test(n)&&(u.value[e]=o.error_message,t=!1),e==="custom_date_of_birth"&&(n?new Date(n)>new Date?(u.value[e]="You cannot select a future date.",t=!1):delete u.value[e]:(u.value[e]="Date of birth is required.",t=!1))}}return t},Y=()=>_(this,null,function*(){if(!R()){G();return}try{let t=yield r("mykartavya.controllers.api.update_sva_user",{data:{first_name:a.value.first_name,last_name:a.value.last_name||"",mobile_number:a.value.mobile_number,custom_date_of_birth:a.value.custom_date_of_birth,custom_country:a.value.custom_country,custom_state:a.value.custom_state,custom_city:a.value.custom_city,custom_company:a.value.custom_company||"",custom_title:a.value.custom_title||"",custom_portfolio:a.value.custom_portfolio||"",custom_cv:a.value.custom_cv||"",custom_linkedin:a.value.custom_linkedin||""}});t.status==200?(h.success("Profile updated successfully!",{autoClose:3e3}),setTimeout(()=>k.push("/"),3e3)):h.error(t.message||"Failed to update profile.")}catch(t){h.error("An error occurred while updating the profile.")}}),Z=t=>{switch(t){case"custom_country":return q.value.map(s=>({name:s.name,label:s.label||s.name}));case"custom_state":return S.value.map(s=>({name:s.name,label:s.state_name||s.name}));case"custom_city":return F.value.map(s=>({name:s.name,label:s.district_name||s.name}));case"custom_company":return I.value.map(s=>({name:s.name,label:s.company_name||s.name}));default:return[]}};ee(()=>{M(),O(),z(),localStorage.getItem("updateprofile")=="true"&&(h.error("Please update your profile to continue.",{autoClose:3e3}),localStorage.removeItem("updateprofile"))});const G=()=>_(this,null,function*(){if(v.value){yield ne();const t=document.querySelector(`[name="${v.value}"]`);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.focus()),v.value=null}}),H=t=>_(this,null,function*(){const s=t.target.files[0];if(s)try{const e=new FormData;e.append("file",s),e.append("doctype","SVA User"),e.append("docname",l.cookie.name),e.append("fieldname","custom_cv");const o=yield r("frappe.client.attach_file",e);o&&(a.value.custom_cv=o.file_url,h.success("CV uploaded successfully!"))}catch(e){console.error("CV upload error:",e),h.error("Failed to upload CV")}}),J=t=>_(this,null,function*(){const s=t.target.files[0];if(s)try{const e=new FormData;e.append("file",s),e.append("doctype","SVA User"),e.append("docname",l.cookie.name),e.append("fieldname","custom_portfolio");const o=yield r("frappe.client.attach_file",e);o&&(a.value.custom_portfolio=o.file_url,h.success("Portfolio uploaded successfully!"))}catch(e){console.error("Portfolio upload error:",e),h.error("Failed to upload Portfolio")}});return(t,s)=>(m(),i("div",ue,[c("div",ie,[c("div",me,[s[1]||(s[1]=c("div",{class:"w-full h-[152px]"},[c("img",{src:ce,alt:"Banner",class:"w-full h-full object-cover"})],-1)),c("div",de,[c("div",_e,[w(l).user_image?(m(),i("img",{key:0,src:w(l).user_image,alt:"Profile",class:"w-full h-full object-cover"},null,8,pe)):(m(),i("div",fe,y(w(l).cookie.full_name.charAt(0)),1))])])]),c("div",ye,[c("h1",ve,y(w(l).cookie.full_name),1),c("p",be,y(w(l).cookie.user_id),1)])]),c("div",he,[c("div",ge,[c("div",null,[s[3]||(s[3]=c("h2",{class:"text-xl font-semibold text-gray-700 mb-4"},"Personal Info",-1)),c("form",{onSubmit:te(Y,["prevent"])},[c("div",xe,[(m(!0),i(A,null,E(x.value,(e,o)=>(m(),i("div",{key:o},[c("label",we,[ae(y(e.label)+" ",1),e.required?(m(),i("span",ke,"*")):g("",!0)]),o!=="custom_date_of_birth"&&e.type!=="select"&&e.type!=="file"?D((m(),i("input",{key:0,"onUpdate:modelValue":n=>a.value[o]=n,type:e.type,name:o,placeholder:e.placeholder,readonly:e.readonly,class:N(["block w-full border border-gray-300 text-bodyh2 rounded py-2 px-3 focus:outline-none focus:ring focus:ring-orange-200",{"bg-gray-100":e.readonly}])},null,10,Ce)),[[se,a.value[o]]]):o==="custom_date_of_birth"?D((m(),i("input",{key:1,"onUpdate:modelValue":s[0]||(s[0]=n=>a.value.custom_date_of_birth=n),type:"date",name:"custom_date_of_birth",max:p.value,class:"block w-full border border-gray-300 text-bodyh2 rounded py-2 px-3 focus:outline-none focus:ring focus:ring-orange-200"},null,8,De)),[[le,a.value.custom_date_of_birth]]):e.type==="file"?(m(),i("div",qe,[o==="custom_portfolio"?(m(),i("input",{key:0,type:"file",id:"portfolioInput",name:o,onChange:J,class:"hidden"},null,40,Se)):g("",!0),o==="custom_cv"?(m(),i("input",{key:1,type:"file",id:"cvInput",name:o,onChange:H,class:"hidden"},null,40,Fe)):g("",!0),c("div",Ie,[c("button",{type:"button",onClick:n=>j(o),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-sm transition"},y(a.value[o]?"Change File":"Upload File"),9,Pe),a.value[o]?(m(),i("span",Ve,y(a.value[o].split("/").pop()),1)):g("",!0)])])):g("",!0),e.type==="select"?D((m(),i("select",{key:3,"onUpdate:modelValue":n=>a.value[o]=n,name:o,disabled:e.readonly,class:N(["block w-full border border-gray-300 text-bodyh2 rounded py-2 px-3 focus:outline-none focus:ring focus:ring-orange-200",{"bg-gray-100":e.readonly}])},[c("option",Te,"Select "+y(e.label),1),(m(!0),i(A,null,E(Z(o),n=>(m(),i("option",{key:n.name,value:n.name},y(n.label||n.name),9,Be))),128))],10,Ue)),[[re,a.value[o]]]):g("",!0),u.value[o]?(m(),i("p",Ae,y(u.value[o]),1)):g("",!0)]))),128))]),s[2]||(s[2]=c("div",{class:"mt-6"},[c("button",{type:"submit",class:"bg-orange-500 text-white font-semibold py-2 px-4 rounded-sm hover:bg-orange-600 transition"}," UPDATE ")],-1))],32)])])])]))}};export{Oe as default};
