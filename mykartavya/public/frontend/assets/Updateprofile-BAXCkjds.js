var v=(S,m,c)=>new Promise((k,p)=>{var g=l=>{try{y(c.next(l))}catch(b){p(b)}},s=l=>{try{y(c.throw(l))}catch(b){p(b)}},y=l=>l.done?k(l.value):Promise.resolve(l.value).then(g,s);y((c=c.apply(S,m)).next())});import{r as d,l as I,o as H,c as u,a as o,u as h,i as j,t as _,z as O,F as M,h as T,y as L,j as i,s as C,m as x,f as R,ac as Y,v as Z,ad as G,a1 as J}from"./index-C8wxGTCC.js";import{_ as K}from"./Rectangle-Cxb5RPqE.js";import{l as w}from"./index-CLOZz_PL.js";/* empty css              */const Q={class:"max-w-[1920px] mx-auto px-10 pt-[82px] pb-4 bg-gray-50"},W={class:"h-[261px] rounded-b-md bg-white"},X={class:"relative"},ee={class:"absolute left-8 -bottom-8"},te={class:"w-32 h-32 rounded-full border-4 border-white overflow-hidden"},oe=["src"],ae={key:1,class:"w-full h-full bg-gray-200 flex items-center justify-center text-[40px] text-gray-600"},se={class:"pt-10 px-4"},re={class:"text-3xl font-medium"},le={class:"text-bodyh1 text-gray-600 mt-1"},ne={class:"bg-white rounded-lg shadow mt-4"},ue={class:"p-6"},ie={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ce={class:"block text-bodyh1 font-normal text-gray-700 mb-1"},de={key:0,class:"text-red-500 pt-2"},me=["onUpdate:modelValue","type","name","placeholder"],pe=["max"],fe=["onUpdate:modelValue","name"],ve={value:"",disabled:""},_e=["value"],be={key:3,class:"text-red-500 text-[11px] mt-1"},Ce={__name:"Updateprofile",setup(S){const m=j("call"),c=j("auth"),k=L(),p=d(null),g=d({first_name:{label:"First Name",type:"text",required:!0,pattern:/^[A-Za-z]+$/,error_message:"Please enter a valid first name (letters only)"},last_name:{label:"Last Name",type:"text",required:!1},mobile_number:{label:"Phone No.",type:"text",required:!0,pattern:/^[0-9]{10}$/,error_message:"Invalid phone number "},custom_country:{label:"Country",type:"select",required:!0},custom_state:{label:"State",type:"select",required:!0},custom_city:{label:"City",type:"select",required:!0},custom_company:{label:"Company",type:"select",required:!1},custom_date_of_birth:{label:"Date of Birth",type:"date",required:!0,min:"1900-01-01",max:new Date().toISOString().split("T")[0],max:"maxDate",error_message:"Please select a valid date of birth"},title:{label:"Title",type:"text",placeholder:"Enter your title",required:!1}}),s=d({first_name:"",last_name:"",mobile_number:"",custom_country:"",custom_state:"",custom_city:"",custom_company:"",custom_date_of_birth:"",title:""}),y=d(new Date().toISOString().split("T")[0]),l=d({}),b=d([]),q=d([]),D=d([]),P=d([]),V=()=>v(this,null,function*(){const t=yield m("mykartavya.controllers.api.country_data");b.value=t||[]}),B=()=>v(this,null,function*(){if(!s.value.custom_country)return;const t=yield m("mykartavya.controllers.api.state_data",{country:s.value.custom_country});q.value=t||[]}),F=()=>v(this,null,function*(){if(!s.value.custom_state)return;const t=yield m("mykartavya.controllers.api.city_data",{state:s.value.custom_state});D.value=t||[]}),U=()=>v(this,null,function*(){const t=yield m("mykartavya.controllers.api.company_data");P.value=t||[]});I(()=>s.value.custom_country,B),I(()=>s.value.custom_state,F);const A=()=>v(this,null,function*(){let t=yield m("mykartavya.controllers.api.sva_user_data");t&&t.length>0&&(s.value=t[0])}),N=()=>{var e;l.value={};let t=!0;for(const a in s.value){const r=g.value[a],n=s.value[a];if(r){if(r.required&&!n&&(l.value[a]=`${r.label} is required.`,t=!1,p.value||(p.value=a)),a==="mobile_number"){const f=n==null?void 0:n.trim();(e=r.pattern)!=null&&e.test(f)||((f==null?void 0:f.length)===0?l.value[a]="Phone number is required.":(f==null?void 0:f.length)!==10?l.value[a]="Phone number must be exactly 10 digits.":l.value[a]=r.error_message,t=!1)}console.log(n),a==="first_name"&&r.pattern&&!r.pattern.test(n)&&(l.value[a]=r.error_message,t=!1),a==="last_name"&&r.pattern&&!r.pattern.test(n)&&(l.value[a]=r.error_message,t=!1),a==="custom_date_of_birth"&&(n?new Date(n)>new Date?(l.value[a]="You cannot select a future date.",t=!1):delete l.value[a]:(l.value[a]="Date of birth is required.",t=!1))}}return t},$=()=>v(this,null,function*(){if(!N()){E();return}try{let t=yield m("mykartavya.controllers.api.update_sva_user",{data:{first_name:s.value.first_name,last_name:s.value.last_name||"",mobile_number:s.value.mobile_number,custom_date_of_birth:s.value.custom_date_of_birth,custom_country:s.value.custom_country,custom_state:s.value.custom_state,custom_city:s.value.custom_city,custom_company:s.value.custom_company||""}});t.status==200?(w.success("Profile updated successfully!",{autoClose:3e3}),setTimeout(()=>k.push("/"),3e3)):w.error(t.message||"Failed to update profile.")}catch(t){w.error("An error occurred while updating the profile.")}}),z=t=>{switch(t){case"custom_country":return b.value.map(e=>({name:e.name,label:e.label||e.name}));case"custom_state":return q.value.map(e=>({name:e.name,label:e.state_name||e.name}));case"custom_city":return D.value.map(e=>({name:e.name,label:e.district_name||e.name}));case"custom_company":return P.value.map(e=>({name:e.name,label:e.company_name||e.name}));default:return[]}};H(()=>{V(),U(),A(),localStorage.getItem("updateprofile")=="true"&&(w.error("Please update your profile to continue.",{autoClose:3e3}),localStorage.removeItem("updateprofile"))});const E=()=>v(this,null,function*(){if(p.value){yield J();const t=document.querySelector(`[name="${p.value}"]`);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.focus()),p.value=null}});return(t,e)=>(i(),u("div",Q,[o("div",W,[o("div",X,[e[5]||(e[5]=o("div",{class:"w-full h-[152px]"},[o("img",{src:K,alt:"Banner",class:"w-full h-full object-cover"})],-1)),o("div",ee,[o("div",te,[h(c).user_image?(i(),u("img",{key:0,src:h(c).user_image,alt:"Profile",class:"w-full h-full object-cover"},null,8,oe)):(i(),u("div",ae,_(h(c).cookie.full_name.charAt(0)),1))])])]),o("div",se,[o("h1",re,_(h(c).cookie.full_name),1),o("p",le,_(h(c).cookie.user_id),1)])]),o("div",ne,[o("div",ue,[o("div",null,[e[13]||(e[13]=o("h2",{class:"text-xl font-semibold text-gray-700 mb-4"},"Personal Info",-1)),o("form",{onSubmit:O($,["prevent"])},[o("div",ie,[(i(!0),u(M,null,T(g.value,(a,r)=>(i(),u("div",{key:r},[o("label",ce,[R(_(a.label)+" ",1),a.required?(i(),u("span",de,"*")):x("",!0)]),r!=="custom_date_of_birth"&&a.type!=="select"?C((i(),u("input",{key:0,"onUpdate:modelValue":n=>s.value[r]=n,type:a.type,name:r,placeholder:a.placeholder,class:"block w-full border border-gray-300 text-bodyh2 rounded py-2 px-3 focus:outline-none focus:ring focus:ring-orange-200"},null,8,me)),[[Y,s.value[r]]]):r==="custom_date_of_birth"?C((i(),u("input",{key:1,"onUpdate:modelValue":e[0]||(e[0]=n=>s.value.custom_date_of_birth=n),type:"date",name:"custom_date_of_birth",max:y.value,class:"block w-full border border-gray-300 text-bodyh2 rounded py-2 px-3 focus:outline-none focus:ring focus:ring-orange-200"},null,8,pe)),[[Z,s.value.custom_date_of_birth]]):x("",!0),a.type==="select"?C((i(),u("select",{key:2,"onUpdate:modelValue":n=>s.value[r]=n,name:r,class:"block w-full border border-gray-300 text-bodyh2 rounded py-2 px-3 focus:outline-none focus:ring focus:ring-orange-200"},[o("option",ve,"Select "+_(a.label),1),(i(!0),u(M,null,T(z(r),n=>(i(),u("option",{key:n.name,value:n.name},_(n.label||n.name),9,_e))),128))],8,fe)),[[G,s.value[r]]]):x("",!0),l.value[r]?(i(),u("p",be,_(l.value[r]),1)):x("",!0)]))),128)),o("div",null,[e[8]||(e[8]=o("label",{class:"block text-bodyh1 font-normal text-gray-700 mb-1"},"Add CV",-1)),o("div",{class:"flex flex-col items-center justify-center border-2 border-dashed border-orange-300 text-orange-500 p-4 rounded cursor-pointer",onClick:e[2]||(e[2]=a=>t.cvInput.click())},[e[6]||(e[6]=o("svg",{class:"w-10 h-10 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"2"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7 3h10M7 3a2 2 0 00-2 2v2m2-2h10m0 0a2 2 0 012 2v2m-2-2H7m13 8V8H4v8a2 2 0 002 2h12a2 2 0 002-2z"})],-1)),e[7]||(e[7]=o("span",{class:"text-bodyh1"},"Click to upload or drag and drop",-1)),o("input",{ref:"cvInput",type:"file",accept:".pdf,.doc,.docx",class:"hidden",onChange:e[1]||(e[1]=(...a)=>t.onCvSelected&&t.onCvSelected(...a))},null,544)])]),o("div",null,[e[11]||(e[11]=o("label",{class:"block text-bodyh1 font-normal text-gray-700 mb-1"},"Add Portfolio",-1)),o("div",{class:"flex flex-col items-center justify-center border-2 border-dashed border-orange-300 text-orange-500 p-4 rounded cursor-pointer",onClick:e[4]||(e[4]=a=>t.portfolioInput.click())},[e[9]||(e[9]=o("svg",{class:"w-10 h-10 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"2"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7 3h10M7 3a2 2 0 00-2 2v2m2-2h10m0 0a2 2 0 012 2v2m-2-2H7m13 8V8H4v8a2 2 0 002 2h12a2 2 0 002-2z"})],-1)),e[10]||(e[10]=o("span",{class:"text-sm"},"Click to upload or drag and drop",-1)),o("input",{ref:"portfolioInput",type:"file",accept:".pdf,.doc,.docx",class:"hidden",onChange:e[3]||(e[3]=(...a)=>t.onPortfolioSelected&&t.onPortfolioSelected(...a))},null,544)])])]),e[12]||(e[12]=o("div",{class:"mt-6"},[o("button",{type:"submit",class:"bg-orange-500 text-white font-semibold py-2 px-4 rounded-sm hover:bg-orange-600 transition"}," UPDATE ")],-1))],32)])])])]))}};export{Ce as default};
