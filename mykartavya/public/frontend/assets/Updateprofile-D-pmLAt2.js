var G=Object.defineProperty;var F=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var I=(_,n,l)=>n in _?G(_,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):_[n]=l,U=(_,n)=>{for(var l in n||(n={}))H.call(n,l)&&I(_,l,n[l]);if(F)for(var l of F(n))J.call(n,l)&&I(_,l,n[l]);return _};var v=(_,n,l)=>new Promise((k,f)=>{var q=p=>{try{h(l.next(p))}catch(c){f(c)}},t=p=>{try{h(l.throw(p))}catch(c){f(c)}},h=p=>p.done?k(p.value):Promise.resolve(p.value).then(q,t);h((l=l.apply(_,n)).next())});import{r as d,s as K,l as V,o as Q,c as i,a as u,u as g,i as B,t as b,D as W,F as N,h as j,B as X,j as m,v as D,m as x,f as ee,ad as te,n as M,x as ae,ae as oe,a2 as se}from"./index-lSk0Zx1-.js";import{_ as le}from"./Rectangle-Cxb5RPqE.js";import{l as w}from"./index-D2-YH967.js";/* empty css              */const re={class:"max-w-[1920px] mx-auto px-10 pt-[82px] pb-4 bg-gray-50"},ne={class:"h-[261px] rounded-b-md bg-white"},ue={class:"relative"},ce={class:"absolute left-8 -bottom-8"},ie={class:"w-32 h-32 rounded-full border-4 border-white overflow-hidden"},me=["src"],de={key:1,class:"w-full h-full bg-gray-200 flex items-center justify-center text-[40px] text-gray-600"},_e={class:"pt-10 px-4"},pe={class:"text-3xl font-medium"},fe={class:"text-bodyh1 text-gray-600 mt-1"},ye={class:"bg-white rounded-lg shadow mt-4"},ve={class:"p-6"},be={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},he={class:"block text-bodyh1 font-normal text-gray-700 mb-1"},ge={key:0,class:"text-red-500 pt-2"},xe=["onUpdate:modelValue","type","name","placeholder","readonly"],we=["max"],ke=["onUpdate:modelValue","name","disabled"],qe={value:"",disabled:""},De=["value"],Se={key:3,class:"text-red-500 text-[11px] mt-1"},Ve={__name:"Updateprofile",setup(_){const n=B("call"),l=B("auth"),k=X(),f=d(null),q=d({first_name:{label:"First Name",type:"text",required:!0,pattern:/^[A-Za-z]+$/,error_message:"Please enter a valid first name (letters only)"},last_name:{label:"Last Name",type:"text",required:!1},mobile_number:{label:"Phone No.",type:"text",required:!0,pattern:/^[0-9]{10}$/,error_message:"Invalid phone number "},custom_country:{label:"Country",type:"select",required:!0},custom_state:{label:"State",type:"select",required:!0},custom_city:{label:"City",type:"select",required:!0},custom_company:{label:"Company",type:"select",required:!1,readonly:!1},custom_date_of_birth:{label:"Date of Birth",type:"date",required:!0,min:"1900-01-01",max:new Date().toISOString().split("T")[0],max:"maxDate",error_message:"Please select a valid date of birth"},custom_title:{label:"Title",type:"text",placeholder:"Enter your title",required:!1},custom_portfolio:{label:"Portfolio",type:"file",required:!1},custom_cv:{label:"CV",type:"file",required:!1},custom_linkedin:{label:"LinkedIn",type:"text",required:!1}}),t=d({first_name:"",last_name:"",mobile_number:"",custom_country:"",custom_state:"",custom_city:"",custom_company:"",custom_date_of_birth:"",custom_title:"",custom_portfolio:"",custom_cv:"",custom_linkedin:""}),h=K(()=>{const e=U({},q.value);return t.value.custom_company?e.custom_company.readonly=!0:delete e.custom_company,e}),p=d(new Date().toISOString().split("T")[0]),c=d({}),S=d([]),C=d([]),P=d([]),T=d([]),A=()=>v(this,null,function*(){const e=yield n("mykartavya.controllers.api.country_data");S.value=e||[]}),E=()=>v(this,null,function*(){if(!t.value.custom_country)return;const e=yield n("mykartavya.controllers.api.state_data",{country:t.value.custom_country});C.value=e||[]}),$=()=>v(this,null,function*(){if(!t.value.custom_state)return;const e=yield n("mykartavya.controllers.api.city_data",{state:t.value.custom_state});P.value=e||[]}),L=()=>v(this,null,function*(){const e=yield n("mykartavya.controllers.api.company_data");T.value=e||[]});V(()=>t.value.custom_country,E),V(()=>t.value.custom_state,$);const O=()=>v(this,null,function*(){let e=yield n("mykartavya.controllers.api.sva_user_data");e&&e.length>0&&(t.value=e[0])}),z=()=>{var o;c.value={};let e=!0;for(const a in t.value){const s=h.value[a],r=t.value[a];if(s){if(s.required&&!r&&(c.value[a]=`${s.label} is required.`,e=!1,f.value||(f.value=a)),a==="mobile_number"){const y=r==null?void 0:r.trim();(o=s.pattern)!=null&&o.test(y)||((y==null?void 0:y.length)===0?c.value[a]="Phone number is required.":(y==null?void 0:y.length)!==10?c.value[a]="Phone number must be exactly 10 digits.":c.value[a]=s.error_message,e=!1)}console.log(r),a==="first_name"&&s.pattern&&!s.pattern.test(r)&&(c.value[a]=s.error_message,e=!1),a==="last_name"&&s.pattern&&!s.pattern.test(r)&&(c.value[a]=s.error_message,e=!1),a==="custom_date_of_birth"&&(r?new Date(r)>new Date?(c.value[a]="You cannot select a future date.",e=!1):delete c.value[a]:(c.value[a]="Date of birth is required.",e=!1))}}return e},R=()=>v(this,null,function*(){if(!z()){Z();return}try{let e=yield n("mykartavya.controllers.api.update_sva_user",{data:{first_name:t.value.first_name,last_name:t.value.last_name||"",mobile_number:t.value.mobile_number,custom_date_of_birth:t.value.custom_date_of_birth,custom_country:t.value.custom_country,custom_state:t.value.custom_state,custom_city:t.value.custom_city,custom_company:t.value.custom_company||"",custom_title:t.value.custom_title||"",custom_portfolio:t.value.custom_portfolio||"",custom_cv:t.value.custom_cv||"",custom_linkedin:t.value.custom_linkedin||""}});e.status==200?(w.success("Profile updated successfully!",{autoClose:3e3}),setTimeout(()=>k.push("/"),3e3)):w.error(e.message||"Failed to update profile.")}catch(e){w.error("An error occurred while updating the profile.")}}),Y=e=>{switch(e){case"custom_country":return S.value.map(o=>({name:o.name,label:o.label||o.name}));case"custom_state":return C.value.map(o=>({name:o.name,label:o.state_name||o.name}));case"custom_city":return P.value.map(o=>({name:o.name,label:o.district_name||o.name}));case"custom_company":return T.value.map(o=>({name:o.name,label:o.company_name||o.name}));default:return[]}};Q(()=>{A(),L(),O(),localStorage.getItem("updateprofile")=="true"&&(w.error("Please update your profile to continue.",{autoClose:3e3}),localStorage.removeItem("updateprofile"))});const Z=()=>v(this,null,function*(){if(f.value){yield se();const e=document.querySelector(`[name="${f.value}"]`);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.focus()),f.value=null}});return d(null),d(null),(e,o)=>(m(),i("div",re,[u("div",ne,[u("div",ue,[o[1]||(o[1]=u("div",{class:"w-full h-[152px]"},[u("img",{src:le,alt:"Banner",class:"w-full h-full object-cover"})],-1)),u("div",ce,[u("div",ie,[g(l).user_image?(m(),i("img",{key:0,src:g(l).user_image,alt:"Profile",class:"w-full h-full object-cover"},null,8,me)):(m(),i("div",de,b(g(l).cookie.full_name.charAt(0)),1))])])]),u("div",_e,[u("h1",pe,b(g(l).cookie.full_name),1),u("p",fe,b(g(l).cookie.user_id),1)])]),u("div",ye,[u("div",ve,[u("div",null,[o[3]||(o[3]=u("h2",{class:"text-xl font-semibold text-gray-700 mb-4"},"Personal Info",-1)),u("form",{onSubmit:W(R,["prevent"])},[u("div",be,[(m(!0),i(N,null,j(h.value,(a,s)=>(m(),i("div",{key:s},[u("label",he,[ee(b(a.label)+" ",1),a.required?(m(),i("span",ge,"*")):x("",!0)]),s!=="custom_date_of_birth"&&a.type!=="select"?D((m(),i("input",{key:0,"onUpdate:modelValue":r=>t.value[s]=r,type:a.type,name:s,placeholder:a.placeholder,readonly:a.readonly,class:M(["block w-full border border-gray-300 text-bodyh2 rounded py-2 px-3 focus:outline-none focus:ring focus:ring-orange-200",{"bg-gray-100":a.readonly}])},null,10,xe)),[[te,t.value[s]]]):s==="custom_date_of_birth"?D((m(),i("input",{key:1,"onUpdate:modelValue":o[0]||(o[0]=r=>t.value.custom_date_of_birth=r),type:"date",name:"custom_date_of_birth",max:p.value,class:"block w-full border border-gray-300 text-bodyh2 rounded py-2 px-3 focus:outline-none focus:ring focus:ring-orange-200"},null,8,we)),[[ae,t.value.custom_date_of_birth]]):x("",!0),a.type==="select"?D((m(),i("select",{key:2,"onUpdate:modelValue":r=>t.value[s]=r,name:s,disabled:a.readonly,class:M(["block w-full border border-gray-300 text-bodyh2 rounded py-2 px-3 focus:outline-none focus:ring focus:ring-orange-200",{"bg-gray-100":a.readonly}])},[u("option",qe,"Select "+b(a.label),1),(m(!0),i(N,null,j(Y(s),r=>(m(),i("option",{key:r.name,value:r.name},b(r.label||r.name),9,De))),128))],10,ke)),[[oe,t.value[s]]]):x("",!0),c.value[s]?(m(),i("p",Se,b(c.value[s]),1)):x("",!0)]))),128))]),o[2]||(o[2]=u("div",{class:"mt-6"},[u("button",{type:"submit",class:"bg-orange-500 text-white font-semibold py-2 px-4 rounded-sm hover:bg-orange-600 transition"}," UPDATE ")],-1))],32)])])])]))}};export{Ve as default};
