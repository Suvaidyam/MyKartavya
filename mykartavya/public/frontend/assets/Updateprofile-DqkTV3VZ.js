var p=(k,m,d)=>new Promise((g,_)=>{var s=c=>{try{y(d.next(c))}catch(b){_(b)}},n=c=>{try{y(d.throw(c))}catch(b){_(b)}},y=c=>c.done?g(c.value):Promise.resolve(c.value).then(s,n);y((d=d.apply(k,m)).next())});import{r as f,k as C,o as F,c as i,d as t,u as h,i as q,t as v,y as T,F as S,h as P,x as z,b as u,q as D,m as V,f as H,C as E,D as O}from"./index-CdvpZXRJ.js";import{_ as L}from"./Rectangle-Cxb5RPqE.js";import{l as x}from"./index-BLgw3bPA.js";const Z={class:"max-w-[1920px] mx-auto px-10 pt-[82px] pb-4 bg-gray-50"},J={class:"h-[261px] rounded-b-md bg-white"},R={class:"relative"},G={class:"absolute left-8 -bottom-8"},K={class:"w-32 h-32 rounded-full border-4 border-white overflow-hidden"},Q=["src"],W={key:1,class:"w-full h-full bg-gray-200 flex items-center justify-center text-[40px] text-gray-600"},X={class:"pt-10 px-4"},Y={class:"text-3xl font-medium"},ee={class:"text-bodyh1 text-gray-600 mt-1"},te={class:"bg-white rounded-lg shadow mt-4 p-6"},ae={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},oe={class:"block text-bodyh1 font-normal text-gray-700 mb-1"},se={key:0,class:"text-red-500 pt-2"},re=["onUpdate:modelValue","type","placeholder"],le=["onUpdate:modelValue"],ne={value:"",disabled:""},ie=["value"],ue={key:2,class:"text-red-500 text-[11px] mt-1"},fe={__name:"Updateprofile",setup(k){const m=q("call"),d=q("auth"),g=z(),_=f({first_name:{label:"First Name",type:"text",required:!1,pattern:/^[A-Za-z]+$/,error_message:"Please enter a valid first name (letters only)"},last_name:{label:"Last Name",type:"text",required:!1,pattern:/^[A-Za-z]+$/,error_message:"Please enter a valid last name (letters only)"},mobile_number:{label:"Phone No.",type:"text",required:!0,pattern:/^[0-9]{10}$/,error_message:"Invalid phone number "},custom_country:{label:"Country",type:"select",required:!0},custom_state:{label:"State",type:"select",required:!0},custom_city:{label:"City",type:"select",required:!0},custom_company:{label:"Company",type:"select",required:!1},custom_date_of_birth:{label:"Date of Birth",type:"date",required:!0,min:"1900-01-01",max:new Date().toISOString().split("T")[0],error_message:"Please select a valid date of birth"},title:{label:"Title",type:"text",placeholder:"Enter your title",required:!1}}),s=f({first_name:"",last_name:"",mobile_number:"",custom_country:"",custom_state:"",custom_city:"",custom_company:"",custom_date_of_birth:"",title:""}),n=f({}),y=f([]),c=f([]),b=f([]),w=f([]),j=()=>p(this,null,function*(){const a=yield m("mykartavya.controllers.api.country_data");y.value=a||[]}),M=()=>p(this,null,function*(){if(!s.value.custom_country)return;const a=yield m("mykartavya.controllers.api.state_data",{country:s.value.custom_country});c.value=a||[]}),A=()=>p(this,null,function*(){if(!s.value.custom_state)return;const a=yield m("mykartavya.controllers.api.city_data",{state:s.value.custom_state});b.value=a||[]}),B=()=>p(this,null,function*(){const a=yield m("mykartavya.controllers.api.company_data");w.value=a||[]});C(()=>s.value.custom_country,M),C(()=>s.value.custom_state,A);const I=()=>p(this,null,function*(){let a=yield m("mykartavya.controllers.api.sva_user_data");a&&a.length>0&&(s.value=a[0])}),N=()=>{n.value={};let a=!0;for(const e in s.value){const o=_.value[e],r=s.value[e];if(o){if(o.required&&!r&&(n.value[e]=`${o.label} is required.`,a=!1),e==="mobile_number"){const l=r.trim();o.pattern.test(l)||(l.length===0?n.value[e]="Phone number is required.":l.length!==10?n.value[e]="Phone number must be exactly 10 digits.":n.value[e]=o.error_message,a=!1)}e==="first_name"&&o.pattern&&!o.pattern.test(r)&&(n.value[e]=o.error_message,a=!1),e==="last_name"&&o.pattern&&!o.pattern.test(r)&&(n.value[e]=o.error_message,a=!1),e==="custom_date_of_birth"&&o.min&&r&&(new Date(o.min),new Date(o.max))}}return a},U=()=>p(this,null,function*(){if(N())try{let a=yield m("mykartavya.controllers.api.update_sva_user",{data:JSON.stringify(s.value)});a.success?(x.success("Profile updated successfully!",{autoClose:3e3}),setTimeout(()=>g.back(-1),3e3)):x.error(a.message||"Failed to update profile.")}catch(a){x.error("An error occurred while updating the profile.")}}),$=a=>{switch(a){case"custom_country":return y.value.map(e=>({name:e.name,label:e.label||e.name}));case"custom_state":return c.value.map(e=>({name:e.name,label:e.state_name||e.name}));case"custom_city":return b.value.map(e=>({name:e.name,label:e.district_name||e.name}));case"custom_company":return w.value.map(e=>({name:e.name,label:e.company_name||e.name}));default:return[]}};return F(()=>{j(),B(),I()}),(a,e)=>(u(),i("div",Z,[t("div",J,[t("div",R,[e[4]||(e[4]=t("div",{class:"w-full h-[152px]"},[t("img",{src:L,alt:"Banner",class:"w-full h-full object-cover"})],-1)),t("div",G,[t("div",K,[h(d).user_image?(u(),i("img",{key:0,src:h(d).user_image,alt:"Profile",class:"w-full h-full object-cover"},null,8,Q)):(u(),i("div",W,v(h(d).cookie.full_name.charAt(0)),1))])])]),t("div",X,[t("h1",Y,v(h(d).cookie.full_name),1),t("p",ee,v(h(d).cookie.user_id),1)])]),t("div",te,[e[12]||(e[12]=t("h2",{class:"text-xl font-semibold text-gray-700 mb-4"},"Personal Info",-1)),t("form",{onSubmit:T(U,["prevent"])},[t("div",ae,[(u(!0),i(S,null,P(_.value,(o,r)=>(u(),i("div",{key:r},[t("label",oe,[H(v(o.label)+" ",1),o.required?(u(),i("span",se,"*")):V("",!0)]),o.type!=="select"?D((u(),i("input",{key:0,"onUpdate:modelValue":l=>s.value[r]=l,type:o.type,placeholder:o.placeholder,class:"block w-full border border-gray-300 text-bodyh2 rounded py-2 px-3 focus:outline-none focus:ring focus:ring-orange-200"},null,8,re)),[[E,s.value[r]]]):D((u(),i("select",{key:1,"onUpdate:modelValue":l=>s.value[r]=l,class:"block w-full border border-gray-300 text-bodyh2 rounded py-2 px-3 focus:outline-none focus:ring focus:ring-orange-200"},[t("option",ne,"Select "+v(o.label),1),(u(!0),i(S,null,P($(r),l=>(u(),i("option",{key:l.name,value:l.name},v(l.label||l.name),9,ie))),128))],8,le)),[[O,s.value[r]]]),n.value[r]?(u(),i("p",ue,v(n.value[r]),1)):V("",!0)]))),128)),t("div",null,[e[7]||(e[7]=t("label",{class:"block text-bodyh1 font-normal text-gray-700 mb-1"},"Add CV",-1)),t("div",{class:"flex flex-col items-center justify-center border-2 border-dashed border-orange-300 text-orange-500 p-4 rounded cursor-pointer",onClick:e[1]||(e[1]=o=>a.cvInput.click())},[e[5]||(e[5]=t("svg",{class:"w-10 h-10 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7 3h10M7 3a2 2 0 00-2 2v2m2-2h10m0 0a2 2 0 012 2v2m-2-2H7m13 8V8H4v8a2 2 0 002 2h12a2 2 0 002-2z"})],-1)),e[6]||(e[6]=t("span",{class:"text-bodyh1"},"Click to upload or drag and drop",-1)),t("input",{ref:"cvInput",type:"file",accept:".pdf,.doc,.docx",class:"hidden",onChange:e[0]||(e[0]=(...o)=>a.onCvSelected&&a.onCvSelected(...o))},null,544)])]),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-bodyh1 font-normal text-gray-700 mb-1"},"Add Portfolio",-1)),t("div",{class:"flex flex-col items-center justify-center border-2 border-dashed border-orange-300 text-orange-500 p-4 rounded cursor-pointer",onClick:e[3]||(e[3]=o=>a.portfolioInput.click())},[e[8]||(e[8]=t("svg",{class:"w-10 h-10 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7 3h10M7 3a2 2 0 00-2 2v2m2-2h10m0 0a2 2 0 012 2v2m-2-2H7m13 8V8H4v8a2 2 0 002 2h12a2 2 0 002-2z"})],-1)),e[9]||(e[9]=t("span",{class:"text-sm"},"Click to upload or drag and drop",-1)),t("input",{ref:"portfolioInput",type:"file",accept:".pdf,.doc,.docx",class:"hidden",onChange:e[2]||(e[2]=(...o)=>a.onPortfolioSelected&&a.onPortfolioSelected(...o))},null,544)])])]),e[11]||(e[11]=t("div",{class:"mt-6"},[t("button",{type:"submit",class:"bg-orange-500 text-white font-semibold py-2 px-4 rounded hover:bg-orange-600 transition"}," UPDATE ")],-1))],32)])]))}};export{fe as default};
